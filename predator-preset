#!/bin/bash
#
# Predator Preset Manager
# Applies predefined combinations of power profiles and fan settings
#
# Usage: predator-preset {silent|normal|gaming|extreme|custom}

SCRIPT_DIR="$(dirname $0)"
PROFILE_SCRIPT="$SCRIPT_DIR/predator-profile"
FAN_SCRIPT="$SCRIPT_DIR/predator-fan"
BATTERY_SCRIPT="$SCRIPT_DIR/predator-battery"
KEYBOARD_SCRIPT="$SCRIPT_DIR/predator-keyboard"

# Fallback to system paths if local scripts not found
if [ ! -x "$PROFILE_SCRIPT" ]; then
    PROFILE_SCRIPT="/usr/local/bin/predator-profile"
fi

if [ ! -x "$FAN_SCRIPT" ]; then
    FAN_SCRIPT="/usr/local/bin/predator-fan"
fi

if [ ! -x "$BATTERY_SCRIPT" ]; then
    BATTERY_SCRIPT="/usr/local/bin/predator-battery"
fi

if [ ! -x "$KEYBOARD_SCRIPT" ]; then
    KEYBOARD_SCRIPT="/usr/local/bin/predator-keyboard"
fi

case "$1" in
    silent)
        echo "Applying SILENT preset..."
        echo "  - Power: Quiet mode (60W)"
        echo "  - Fans: Auto (minimum noise)"
        echo "  - Battery: Limiter enabled (80%)"
        echo "  - Keyboard: Dim white (30%)"
        $PROFILE_SCRIPT quiet
        $FAN_SCRIPT auto
        $BATTERY_SCRIPT enable > /dev/null 2>&1
        $KEYBOARD_SCRIPT brightness 30 > /dev/null 2>&1
        echo ""
        echo "Silent preset applied - Minimal power and noise, battery protected"
        ;;
    
    normal)
        echo "Applying NORMAL preset..."
        echo "  - Power: Balanced mode (80W)"
        echo "  - Fans: Auto"
        echo "  - Battery: Limiter enabled (80%)"
        echo "  - Keyboard: White (70%)"
        $PROFILE_SCRIPT balanced
        $FAN_SCRIPT auto
        $BATTERY_SCRIPT enable > /dev/null 2>&1
        $KEYBOARD_SCRIPT static #ffffff > /dev/null 2>&1
        $KEYBOARD_SCRIPT brightness 70 > /dev/null 2>&1
        echo ""
        echo "Normal preset applied - Balanced performance, battery protected"
        ;;
    
    gaming)
        echo "Applying GAMING preset..."
        echo "  - Power: Performance mode (100W)"
        echo "  - Fans: Custom (60% CPU, 70% GPU)"
        echo "  - Battery: Limiter disabled (100%)"
        echo "  - Keyboard: Gaming RGB profile"
        $PROFILE_SCRIPT performance
        $FAN_SCRIPT custom 60 70
        $BATTERY_SCRIPT disable > /dev/null 2>&1
        $KEYBOARD_SCRIPT profile-gaming > /dev/null 2>&1
        echo ""
        echo "Gaming preset applied - High performance, full battery available"
        ;;
    
    extreme)
        echo "Applying EXTREME preset..."
        echo "  - Power: Turbo mode (125W)"
        echo "  - Fans: Maximum (100%)"
        echo "  - Battery: Limiter disabled (100%)"
        echo "  - Keyboard: Fire effect (100%)"
        $PROFILE_SCRIPT turbo
        $FAN_SCRIPT max
        $BATTERY_SCRIPT disable > /dev/null 2>&1
        $KEYBOARD_SCRIPT profile-fire > /dev/null 2>&1
        echo ""
        echo "EXTREME preset applied - Maximum everything!"
        echo "Warning: This will be LOUD and consume maximum power!"
        ;;
    
    travel)
        echo "Applying TRAVEL preset..."
        echo "  - Power: Balanced mode (80W)"
        echo "  - Fans: Auto"
        echo "  - Battery: Limiter disabled (100% for maximum runtime)"
        echo "  - Keyboard: Off (save battery)"
        $PROFILE_SCRIPT balanced
        $FAN_SCRIPT auto
        $BATTERY_SCRIPT disable > /dev/null 2>&1
        $KEYBOARD_SCRIPT off > /dev/null 2>&1
        echo ""
        echo "Travel preset applied - Balanced performance, maximum battery"
        ;;
    
    custom)
        if [ $# -lt 4 ] || [ $# -gt 5 ]; then
            echo "Custom preset requires parameters:"
            echo "Usage: $0 custom <power_profile> <cpu_fan> <gpu_fan> [battery]"
            echo ""
            echo "Power profiles: quiet, balanced, performance, turbo"
            echo "Fan speeds: 0-100 (0 = auto)"
            echo "Battery: enable/disable (optional)"
            echo ""
            echo "Example: $0 custom performance 50 60"
            echo "Example: $0 custom turbo 80 90 disable"
            exit 1
        fi
        
        POWER=$2
        CPU_FAN=$3
        GPU_FAN=$4
        BATTERY=$5
        
        echo "Applying CUSTOM preset..."
        echo "  - Power: $POWER"
        echo "  - Fans: CPU=$CPU_FAN%, GPU=$GPU_FAN%"
        if [ ! -z "$BATTERY" ]; then
            echo "  - Battery: $BATTERY"
        fi
        
        $PROFILE_SCRIPT $POWER
        if [ "$CPU_FAN" = "0" ] && [ "$GPU_FAN" = "0" ]; then
            $FAN_SCRIPT auto
        else
            $FAN_SCRIPT custom $CPU_FAN $GPU_FAN
        fi
        
        if [ "$BATTERY" = "enable" ]; then
            $BATTERY_SCRIPT enable > /dev/null 2>&1
        elif [ "$BATTERY" = "disable" ]; then
            $BATTERY_SCRIPT disable > /dev/null 2>&1
        fi
        
        echo ""
        echo "Custom preset applied"
        ;;
    
    status)
        $PROFILE_SCRIPT status
        ;;
    
    *)
        echo "Predator Preset Manager"
        echo ""
        echo "Usage: $0 {silent|normal|gaming|extreme|travel|custom|status}"
        echo ""
        echo "Presets:"
        echo "  silent  - Quiet (60W) + Auto fans + 80% battery + Dim keyboard"
        echo "  normal  - Balanced (80W) + Auto fans + 80% battery + White keyboard"
        echo "  gaming  - Performance (100W) + 60/70% fans + 100% battery + Gaming RGB"
        echo "  extreme - Turbo (125W) + Max fans + 100% battery + Fire RGB"
        echo "  travel  - Balanced (80W) + Auto fans + 100% battery + Keyboard off"
        echo "  custom  - Set custom profile, fans, and battery"
        echo "  status  - Show current settings"
        echo ""
        echo "Custom usage:"
        echo "  $0 custom <power> <cpu_fan> <gpu_fan> [battery]"
        echo ""
        echo "Examples:"
        echo "  $0 silent                           # Quiet operation"
        echo "  $0 gaming                           # Gaming performance"
        echo "  $0 travel                           # For travel/mobility"
        echo "  $0 extreme                          # Maximum everything"
        echo "  $0 custom turbo 80 90               # Turbo with 80/90% fans"
        echo "  $0 custom balanced 0 0 enable       # Balanced, auto fans, 80% battery"
        exit 1
        ;;
esac